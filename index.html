<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>貴金屬單位換算與工錢計算機</title>
    <style>
        body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; border-bottom: 2px solid #ffcc00; padding-bottom: 10px; margin-bottom: 30px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="number"], select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; background-color: #ffaa00; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #e69500; }
        .input-group { display: flex; gap: 10px; align-items: flex-end; }
        .input-group > div { flex-grow: 1; }
        #results div, #craftsmanshipResult div { background: #e9e9e9; padding: 15px; margin-top: 10px; border-radius: 5px; border-left: 5px solid #ffaa00; font-size: 1.1em; }
        .note { margin-top: 25px; font-size: 0.9em; color: #888; text-align: center; }
        .unit { font-weight: normal; color: #000; }
        .section-divider { margin-top: 40px; }
    </style>
</head>
<body>

<div class="container">
    <h1>黃金/白銀單位換算</h1>

    <div class="input-group">
        <div style="flex-basis: 60%;">
            <label for="weight">輸入重量：</label>
            <input type="number" id="weight" value="1" min="0.001" step="any" oninput="convertUnits()">
        </div>
        <div style="flex-basis: 40%;">
            <label for="unit">選擇重量單位：</label>
            <select id="unit" onchange="convertUnits()">
                <option value="qian">台錢 (錢)</option>
                <option value="liang">台兩 (兩)</option>
                <option value="gram">公克 (g)</option>
                <option value="ounce">盎司 (oz)</option>
            </select>
        </div>
    </div>

    <h2>換算結果</h2>
    <div id="results">
        </div>

    <div class="note">
        <p>* 換算基準：1 錢 = 3.75 公克；1 盎司 = 31.1035 公克。</p>
        <p>* 結果會四捨五入至小數點後四位。</p>
    </div>

    <hr class="section-divider">

    <h2>工錢返算</h2>
    
    <div class="input-group">
        <div style="flex-basis: 60%;">
            <label for="metalPrice">金/銀 單價：</label>
            <input type="number" id="metalPrice" placeholder="輸入單價" min="0">
        </div>
        <div style="flex-basis: 40%;">
            <label for="priceUnit">選擇單價單位：</label>
            <select id="priceUnit">
                <option value="qian">每台錢</option>
                <option value="gram">每公克</option>
                <option value="ounce">每盎司</option>
            </select>
        </div>
    </div>

    <label for="jewelryPrice">金飾/銀飾 總價：</label>
    <input type="number" id="jewelryPrice" placeholder="輸入飾品總購買價" min="0">

    <button onclick="calculateCraftsmanship()">計算工錢</button>

    <div id="craftsmanshipResult"></div>

</div>

<script>
    // 核心換算常數
    const QIAN_TO_G = 3.75;          // 1 錢 = 3.75 克
    const OUNCE_TO_G = 31.1035;      // 1 盎司 = 31.1035 克
    const LIANG_TO_QIAN = 10;        // 1 兩 = 10 錢

    function convertUnits() {
        const weightInput = document.getElementById('weight').value;
        const unitInput = document.getElementById('unit').value;
        const resultsDiv = document.getElementById('results');

        const inputWeight = parseFloat(weightInput);
        if (isNaN(inputWeight) || inputWeight <= 0) {
            resultsDiv.innerHTML = '<div>請輸入有效的重量數值。</div>';
            return;
        }

        let baseGram; 
        switch (unitInput) {
            case 'qian':
                baseGram = inputWeight * QIAN_TO_G;
                break;
            case 'liang':
                baseGram = inputWeight * LIANG_TO_QIAN * QIAN_TO_G;
                break;
            case 'gram':
                baseGram = inputWeight;
                break;
            case 'ounce':
                baseGram = inputWeight * OUNCE_TO_G;
                break;
        }

        const resultQian = baseGram / QIAN_TO_G;
        const resultLiang = resultQian / LIANG_TO_QIAN;
        const resultGram = baseGram;
        const resultOunce = baseGram / OUNCE_TO_G;

        resultsDiv.innerHTML = `
            <div><strong>${resultQian.toFixed(4)}</strong> <span class="unit">台錢 (錢)</span></div>
            <div><strong>${resultLiang.toFixed(4)}</strong> <span class="unit">台兩 (兩)</span></div>
            <div><strong>${resultGram.toFixed(4)}</strong> <span class="unit">公克 (g)</span></div>
            <div><strong>${resultOunce.toFixed(4)}</strong> <span class="unit">盎司 (oz)</span></div>
        `;
    }

    function calculateCraftsmanship() {
        const weightInput = document.getElementById('weight').value;
        const weightUnit = document.getElementById('unit').value;
        const metalPriceInput = document.getElementById('metalPrice').value;
        const priceUnit = document.getElementById('priceUnit').value;
        const jewelryPriceInput = document.getElementById('jewelryPrice').value;
        const resultDiv = document.getElementById('craftsmanshipResult');

        const inputWeight = parseFloat(weightInput);
        const metalPrice = parseFloat(metalPriceInput);
        const jewelryPrice = parseFloat(jewelryPriceInput);

        if (isNaN(inputWeight) || inputWeight <= 0 || isNaN(metalPrice) || metalPrice <= 0 || isNaN(jewelryPrice) || jewelryPrice <= 0) {
            resultDiv.innerHTML = '<div>請輸入有效的重量、單價與總價。</div>';
            return;
        }

        // --- 核心修改：將所有單位換算成 "台錢" 進行計算 ---

        // 1. 將輸入的重量，全部換算成 "台錢"
        let weightInQian;
        switch (weightUnit) {
            case 'qian':
                weightInQian = inputWeight;
                break;
            case 'liang':
                weightInQian = inputWeight * LIANG_TO_QIAN;
                break;
            case 'gram':
                weightInQian = inputWeight / QIAN_TO_G;
                break;
            case 'ounce':
                weightInQian = (inputWeight * OUNCE_TO_G) / QIAN_TO_G;
                break;
        }

        // 2. 將輸入的單價，全部換算成 "每台錢" 的價格
        let pricePerQian;
        switch (priceUnit) {
            case 'qian':
                pricePerQian = metalPrice;
                break;
            case 'gram':
                pricePerQian = metalPrice * QIAN_TO_G;
                break;
            case 'ounce':
                pricePerQian = (metalPrice / OUNCE_TO_G) * QIAN_TO_G;
                break;
        }
        
        // 3. 計算成本與工錢
        const materialCost = weightInQian * pricePerQian;
        const craftsmanshipCost = jewelryPrice - materialCost;

        if (craftsmanshipCost < 0) {
            resultDiv.innerHTML = `
                <div>材料成本: <strong>${Math.round(materialCost)}</strong> 元</div>
                <div>總價似乎低於材料成本，請檢查輸入數值。</div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div>材料成本約: <strong>${Math.round(materialCost)}</strong> 元</div>
                <div>工錢約: <strong>${Math.round(craftsmanshipCost)}</strong> 元</div>
            `;
        }
    }

    // 頁面載入時先執行一次計算
    window.onload = convertUnits;
</script>

</body>
</html>
