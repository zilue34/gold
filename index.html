<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>貴金屬單位換算與工錢計算機</title>
    <style>
        body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; border-bottom: 2px solid #ffcc00; padding-bottom: 10px; margin-bottom: 30px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="number"], select {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: #fff;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpolygon%20points%3D%220%2C0%2020%2C0%2010%2C10%22%20style%3D%22fill%3A%23666666%3B%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px;
            padding-right: 30px; 
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
        button { width: 100%; padding: 15px; background-color: #ffaa00; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #e69500; }
        .input-group { display: flex; gap: 10px; align-items: flex-end; }
        .input-group > div { flex-grow: 1; }
        #results div, #craftsmanshipResult div { background: #e9e9e9; padding: 15px; margin-top: 10px; border-radius: 5px; border-left: 5px solid #ffaa00; font-size: 1.1em; }
        .note { margin-top: 25px; font-size: 0.9em; color: #888; text-align: center; }
        .unit { font-weight: normal; color: #000; }
        .section-divider { margin-top: 40px; }
        #exchangeRateDiv { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>黃金/白銀單位換算</h1>

    <div class="input-group">
        <div style="flex-basis: 60%;">
            <label for="weight">輸入重量：</label>
            <input type="number" id="weight" value="1" min="0.001" step="any" oninput="convertUnits()">
        </div>
        <div style="flex-basis: 40%;">
            <label for="unit">選擇重量單位：</label>
            <select id="unit" onchange="convertUnits()">
                <option value="qian">台錢 (錢)</option>
                <option value="liang">台兩 (兩)</option>
                <option value="gram">公克 (g)</option>
                <option value="ounce">盎司 (oz)</option>
            </select>
        </div>
    </div>

    <h2>換算結果</h2>
    <div id="results"></div>

    <div class="note">
        <p>* 換算基準：1 錢 = 3.75 公克；1 盎司 = 31.1035 公克。</p>
        <p>* 結果會四捨五入至小數點後四位。</p>
    </div>

    <hr class="section-divider">

    <h2>工錢返算</h2>
    
    <div class="input-group">
        <div style="flex-basis: 40%;">
            <label for="metalPrice">金/銀 單價：</label>
            <input type="number" id="metalPrice" placeholder="輸入單價" min="0">
        </div>
        <div style="flex-basis: 30%;">
            <label for="priceUnit">單價單位：</label>
            <select id="priceUnit">
                <option value="qian">每台錢</option>
                <option value="gram">每公克</option>
                <option value="ounce">每盎司</option>
            </select>
        </div>
        <div style="flex-basis: 30%;">
            <label for="priceCurrency">單價幣別：</label>
            <select id="priceCurrency" onchange="toggleExchangeRate()">
                <option value="TWD">台幣 (TWD)</option>
                <option value="USD">美元 (USD)</option>
            </select>
        </div>
    </div>

    <div class="input-group">
        <div style="flex-basis: 60%;">
            <label for="jewelryPrice">金飾/銀飾 總價：</label>
            <input type="number" id="jewelryPrice" placeholder="輸入總價" min="0">
        </div>
        <div style="flex-basis: 40%;">
            <label for="totalPriceCurrency">總價幣別：</label>
            <select id="totalPriceCurrency" onchange="toggleExchangeRate()">
                <option value="TWD">台幣 (TWD)</option>
                <option value="USD">美元 (USD)</option>
            </select>
        </div>
    </div>

    <div id="exchangeRateDiv">
        <label for="exchangeRate">美元匯率 (USD to TWD)：</label>
        <input type="number" id="exchangeRate" placeholder="例如：32.5" min="0" value="32.5">
    </div>

    <button onclick="calculateCraftsmanship()">計算工錢</button>

    <div id="craftsmanshipResult"></div>

</div>

<script>
    const QIAN_TO_G = 3.75;
    const OUNCE_TO_G = 31.1035;
    const LIANG_TO_QIAN = 10;

    function convertUnits() {
        const weightInput = document.getElementById('weight').value;
        const unitInput = document.getElementById('unit').value;
        const resultsDiv = document.getElementById('results');
        const inputWeight = parseFloat(weightInput);
        if (isNaN(inputWeight) || inputWeight <= 0) {
            resultsDiv.innerHTML = '<div>請輸入有效的重量數值。</div>';
            return;
        }
        let baseGram;
        switch (unitInput) {
            case 'qian': baseGram = inputWeight * QIAN_TO_G; break;
            case 'liang': baseGram = inputWeight * LIANG_TO_QIAN * QIAN_TO_G; break;
            case 'gram': baseGram = inputWeight; break;
            case 'ounce': baseGram = inputWeight * OUNCE_TO_G; break;
        }
        const resultQian = baseGram / QIAN_TO_G;
        const resultLiang = resultQian / LIANG_TO_QIAN;
        resultsDiv.innerHTML = `
            <div><strong>${resultQian.toFixed(4)}</strong> <span class="unit">台錢 (錢)</span></div>
            <div><strong>${resultLiang.toFixed(4)}</strong> <span class="unit">台兩 (兩)</span></div>
            <div><strong>${baseGram.toFixed(4)}</strong> <span class="unit">公克 (g)</span></div>
            <div><strong>${(baseGram / OUNCE_TO_G).toFixed(4)}</strong> <span class="unit">盎司 (oz)</span></div>
        `;
    }

    function toggleExchangeRate() {
        const priceCurrency = document.getElementById('priceCurrency').value;
        const totalPriceCurrency = document.getElementById('totalPriceCurrency').value;
        const exchangeRateDiv = document.getElementById('exchangeRateDiv');
        
        if (priceCurrency === 'USD' || totalPriceCurrency === 'USD') {
            exchangeRateDiv.style.display = 'block';
        } else {
            exchangeRateDiv.style.display = 'none';
        }
    }

    function calculateCraftsmanship() {
        const resultDiv = document.getElementById('craftsmanshipResult');
        const inputWeight = parseFloat(document.getElementById('weight').value);
        const metalPrice = parseFloat(document.getElementById('metalPrice').value);
        const jewelryPrice = parseFloat(document.getElementById('jewelryPrice').value);
        
        const priceCurrency = document.getElementById('priceCurrency').value;
        const totalPriceCurrency = document.getElementById('totalPriceCurrency').value;
        const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);

        if (isNaN(inputWeight) || isNaN(metalPrice) || isNaN(jewelryPrice) || inputWeight <= 0 || metalPrice <= 0 || jewelryPrice <= 0) {
            resultDiv.innerHTML = '<div>請輸入有效的重量、單價與總價。</div>';
            return;
        }
        
        if ((priceCurrency === 'USD' || totalPriceCurrency === 'USD') && (isNaN(exchangeRate) || exchangeRate <= 0)) {
            resultDiv.innerHTML = '<div>請輸入有效的美元匯率。</div>';
            return;
        }

        // 1. 將重量換算成 "台錢"
        const weightUnit = document.getElementById('unit').value;
        let weightInQian;
        switch (weightUnit) {
            case 'qian': weightInQian = inputWeight; break;
            case 'liang': weightInQian = inputWeight * LIANG_TO_QIAN; break;
            case 'gram': weightInQian = inputWeight / QIAN_TO_G; break;
            case 'ounce': weightInQian = (inputWeight * OUNCE_TO_G) / QIAN_TO_G; break;
        }

        // 2. 將單價換算成 "每台錢" 的價格 (幣別先不處理)
        const priceUnit = document.getElementById('priceUnit').value;
        let pricePerQian;
        switch (priceUnit) {
            case 'qian': pricePerQian = metalPrice; break;
            case 'gram': pricePerQian = metalPrice * QIAN_TO_G; break;
            case 'ounce': pricePerQian = (metalPrice / OUNCE_TO_G) * QIAN_TO_G; break;
        }
        
        // 3. 計算材料成本 (幣別先不處理)
        let materialCost = weightInQian * pricePerQian;
        
        // 4. 將材料成本和總價，全部換算成 "台幣"
        let materialCostTWD = (priceCurrency === 'USD') ? materialCost * exchangeRate : materialCost;
        let jewelryPriceTWD = (totalPriceCurrency === 'USD') ? jewelryPrice * exchangeRate : jewelryPrice;
        
        // 5. 計算最終工錢
        const craftsmanshipCostTWD = jewelryPriceTWD - materialCostTWD;
        
        let originalMaterialCostStr = `${Math.round(materialCost)} (${priceCurrency})`;
        let originalJewelryPriceStr = `${Math.round(jewelryPrice)} (${totalPriceCurrency})`;

        resultDiv.innerHTML = `
            <div>材料成本: <strong>${originalMaterialCostStr}</strong> ≈ <strong>${Math.round(materialCostTWD)}</strong> 元 (台幣)</div>
            <div>飾品總價: <strong>${originalJewelryPriceStr}</strong> ≈ <strong>${Math.round(jewelryPriceTWD)}</strong> 元 (台幣)</div>
            <div style="border-left-color: #007bff;">工錢約: <strong>${Math.round(craftsmanshipCostTWD)}</strong> 元 (台幣)</div>
        `;
    }

    window.onload = convertUnits;
</script>

</body>
</html>
